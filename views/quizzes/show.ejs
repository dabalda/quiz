<div class="row">
  <h2>Pregunta</h2>
</div>
<div class="row">
	<%- include ../favourites/_stars.ejs %>
</div>
<div class="row">
  <blockquote>
	<p><%= quiz.question %></p>
  	<footer>
  	  <% if (quiz.AuthorId) {
      if (quiz.Author) { %>
      <a href="/users/<%= quiz.AuthorId %>"><%= quiz.Author.username %></a>
      <% } else { %>
      Usuario eliminado
      <% } %>
      <% } else { %>
      Anónimo
      <% } %>
  	</footer>
  </blockquote>
</div>

<% if (quiz.Attachment) { %>
<div class="row quiz-img">
  <img src="<%= quiz.Attachment.url %>" />
</div>
<% } %> 

<div class="row">
  <form role="form" class="form-signin" method="get" action="/quizzes/<%= quiz.id %>/check">  
    <input type="text" class="form-control" name="answer" value="<%= answer %>" placeholder="Respuesta" required=""/>
    <button type="submit" class="btn btn-block">Comprobar</button>
  </form>
</div>

<div class="row">
  <h2>Comentarios</h2>	
</div>

<% if (session.user) { %>
<div class="row">
  <a href="/quizzes/<%= quiz.id %>/comments/new"><button>Nuevo comentario</button></a>
</div>
<% } %>
<div class="row">
<% if (quiz.Comments.length === 0) { %>
  <p>Todavía no hay ningún comentario</p>  
<% } %>
<% for (var i in quiz.Comments) { %>
  <div class="row">
      <% var comment = quiz.Comments[i];
      if (comment.accepted) { %>
        <%= comment.text %> 
           <p>
   			<% if (comment.AuthorId) {
            if (comment.Author) {%>
      			 Por <a href="/users/<%= comment.AuthorId %>"><%= comment.Author.username %></a>
          <% } else { %>
                Usuario eliminado
          <% } %>
        <% } else { %>
      			Anónimo
   	 		<% } %>
        <% if (session.user && 
                      (session.user.isAdmin || 
                      (quiz.AuthorId === session.user.id) || 
                      (comment.AuthorId === session.user.id))) { %>
           <a href="/quizzes/<%= quiz.id %>/comments/<%= comment.id %>?_method=DELETE">
              <button>Borrar</button>
           </a>
        <% } %>            
    	   </p>

       <% } else if (session.user &&
                     (session.user.isAdmin || (quiz.AuthorId === session.user.id))) { %>

           <li> <%= comment.text %> </li>
           <p>
   			<% if (comment.AuthorId) {
            if (comment.Author) { %>
      			 Por <a href="/users/<%= comment.AuthorId %>"><%= comment.Author.username %></a>
          <% } else { %>
                Usuario eliminado
          <% } %>
        <% } else { %>
      			Anónimo
   	 		<% } %>
           <a href="/quizzes/<%= quiz.id %>/comments/<%= comment.id %>/accept?_method=PUT">
              <button>Aceptar</button>
           </a>
           <a href="/quizzes/<%= quiz.id %>/comments/<%= comment.id %>?_method=DELETE">
              <button>Borrar</button>
           </a>
          </p>
       <% } else if (session.user && (comment.AuthorId === session.user.id)) { %>
           <li> 
            <%= comment.text %> 
           </li>
           <p>
             Su comentario todavía no ha sido aprobado.
             <a href="/quizzes/<%= quiz.id %>/comments/<%= comment.id %>?_method=DELETE">
                <button>Borrar</button>
             </a>
           </p>
       <% } %>
  </div>
<% } %>
</div>